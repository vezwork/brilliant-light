(()=>{"use strict";var n=function(n,t){return[n[0]+t[0],n[1]+t[1]]},t=function(n,t){return[n[0]-t[0],n[1]-t[1]]},e=function(n,t){return[n*t[0],n*t[1]]},i=function(n,t){return n[0]*t[0]+n[1]*t[1]},o=function(n){return Math.sqrt(i(n,n))},a=function(n){return Math.atan2(n[1],n[0])},l=function(n,e){return a(t(e,n))},r=function(n,e){return o(t(n,e))},u=function(n){return[Math.cos(n),Math.sin(n)]},s=function(o,a){var l=a[0],r=a[1],u=t(o,l),s=t(r,l),g=i(s,s),c=function(i,o){var a=i[0];return n(a,e(o,t(i[1],a)))}([l,r],0===g?-1:Math.max(0,Math.min(1,i(u,s)/g)));return t(o,c)},g=function(n,t){return c(t-n+Math.PI,2*Math.PI)-Math.PI},c=function(n,t){return n-Math.floor(n/t)*t},d=[[[350,100],[350,340]],[[550,100],[550,340]]],h=function(t,i){var o=u(i);return n(t,e(40,o))},v=document.getElementById("main_canvas"),p=function(n,t){return{tip:n,angle:t,trail:[[n,n]],isMoving:!0}},f=function(t){var i=t.tip,o=t.angle,a=t.trail,l=t.isMoving;return a[a.length-1][1]=i,{tip:n(i,e(3,u(o))),angle:o,trail:a,isMoving:l}},y=function(n,t){var e,i,o=n.tip,a=n.angle,r=n.trail,u=n.isMoving,s=function(n,t,e){if(e||2===arguments.length)for(var i,o=0,a=t.length;o<a;o++)!i&&o in t||(i||(i=Array.prototype.slice.call(t,0,o)),i[o]=t[o]);return n.concat(i||Array.prototype.slice.call(t))}([],r,!0);return s.push([o,o]),{tip:o,angle:(e=a,i=l.apply(void 0,t),i+g(e,i)),trail:s,isMoving:u}},m=function(n,t,e){if(e||2===arguments.length)for(var i,o=0,a=t.length;o<a;o++)!i&&o in t||(i||(i=Array.prototype.slice.call(t,0,o)),i[o]=t[o]);return n.concat(i||Array.prototype.slice.call(t))},M=145,b=v.getContext("2d"),A=document.getElementById("eye_img"),I=document.getElementById("handle_img"),D=document.getElementById("lightbulb_img"),w=document.getElementById("lightbulb_dance1_img"),E=document.getElementById("lightbulb_dance2_img"),P=function(n,t,e){var i=t[0],o=t[1];void 0===e&&(e=1),n.lineWidth=e,n.beginPath(),n.moveTo.apply(n,i),n.lineTo.apply(n,o),n.stroke()},R=function(n,i,a,l){void 0===l&&(l=1);var r,u=[i.width,i.height],s=e(l,e(1/o(r=u),r));n.drawImage.apply(n,m(m([i],t(a,e(.5,s)),!1),s,!1))};v.addEventListener("mousedown",(function(n){B.isMouseDown=!0})),v.addEventListener("mouseup",(function(n){B.isMouseDown=!1})),v.addEventListener("mouseleave",(function(n){B.isMouseDown=!1})),v.addEventListener("mousemove",(function(n){B.mousePos=[n.offsetX,n.offsetY]}));var S=0,_={eye:{pos:[450,400],angle:-Math.PI/2},bulb:{pos:[450,100]},solidRay:null,dottedRay:null,isInSuccessState:!1,isDraggingHandle:!1,handleAlpha:1},B={mousePos:[0,0],isMouseDown:!1};requestAnimationFrame((function e(){requestAnimationFrame(e),function(e,i,o){var a=e.eye,l=a.pos,u=a.angle,s=e.bulb.pos,g=e.solidRay,c=e.dottedRay,p=e.isInSuccessState,f=e.handleAlpha,y=i.mousePos,m=i.isMouseDown;b.clearRect(0,0,v.width,v.height),R(b,A,l,64);for(var S=0,_=d;S<_.length;S++)P(b,_[S],12);if(p){var B,L=((null==g?void 0:g.trail.length)-1)%2==1;B=n(c.tip,L?[g.tip[0]-s[0],s[1]-g.tip[1]]:t(s,g.tip)),o%60*2>60?(b.globalAlpha=.5,R(b,L?w:E,B,M),b.globalAlpha=1,R(b,E,s,M)):(b.globalAlpha=.5,R(b,L?E:w,B,M),b.globalAlpha=1,R(b,w,s,M))}else R(b,D,s,64);if(b.strokeStyle="#F3D015",g)for(var k=0,q=g.trail;k<q.length;k++){var F=q[k];P(b,F,5)}if(b.setLineDash([5,5]),c)for(var H=0,x=c.trail;H<x.length;H++)F=x[H],P(b,F,5);b.setLineDash([]),b.strokeStyle="black",r(h(l,u),y)<40?(document.body.style.cursor="grab",m&&(document.body.style.cursor="grabbing")):document.body.style.cursor="default",b.globalAlpha=f,R(b,I,h(l,u),80),b.globalAlpha=1}(_=function(n,e){var i=n.eye,l=i.pos,u=i.angle,g=n.bulb.pos,c=n.solidRay,m=n.dottedRay,M=n.isDraggingHandle,b=n.handleAlpha,A=e.mousePos,I=e.isMouseDown,D=!I&&M;D&&(c=p(l,u),m=p(l,u));var w=c&&r(c.tip,g)<32;if(null==c?void 0:c.isMoving){for(var E=0,P=d;E<P.length;E++){var R=P[E];o(s(c.tip,R))<12&&(c=y(c,R))}r.apply(void 0,c.trail[c.trail.length-1])>v.height&&(c.isMoving=!1,m.isMoving=!1),w&&(c.isMoving=!1,m.isMoving=!1)}var S,_,B=I&&M?a(t(A,l)):u,L=r(h(l,u),A)<40,k=(null==c?void 0:c.trail.length)-1||0,q=!D&&w&&k>0,F=(null==c?void 0:c.isMoving)?.2:1;return{eye:{pos:l,angle:B},bulb:{pos:g},solidRay:(null==c?void 0:c.isMoving)?f(c):c,dottedRay:(null==m?void 0:m.isMoving)?f(m):m,isInSuccessState:q,isDraggingHandle:I&&L,handleAlpha:(S=b,_=F,20,S-(S-_)/20)}}(_,B),B,S),S++}))})();